/*
{
    "quiz_id": "c22fb2a5-ccb9-493a-9c16-68848ef76345",
    "auth_id": "7070afde-f8b5-487e-a288-f2be9d162b0b",
    "created_at": 1704689955000,
    "num_play_times": 0,
    "is_public": true,
    "num_questions": 10,
    "has_draft": true,
    "title": "Seeding Quiz",
    "image": null,
    "description": "This is a seeded quiz for testing purposes.",
    "questions": [
        {
            "index": 0,
            "question": "What is the capital of Canada?",
            "time_limit": 30000,
            "allow_powerups": true,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "Ottawa",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Toronto",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Vancouver",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "Montreal",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 1,
            "question": "Which planet is known as the Red Planet?",
            "time_limit": 40000,
            "allow_powerups": false,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "Mars",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Jupiter",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Saturn",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "Neptune",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 2,
            "question": "What is the largest mammal on Earth?",
            "time_limit": 45000,
            "allow_powerups": true,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "Blue Whale",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Elephant",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Giraffe",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "Hippopotamus",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 3,
            "question": "Who wrote 'Romeo and Juliet'?",
            "time_limit": 35000,
            "allow_powerups": false,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "William Shakespeare",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Jane Austen",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Charles Dickens",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "Emily BrontÃ«",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 4,
            "question": "What is the capital of Japan?",
            "time_limit": 30000,
            "allow_powerups": true,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "Tokyo",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Seoul",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Beijing",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "Shanghai",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 5,
            "question": "Which element has the chemical symbol 'O'?",
            "time_limit": 40000,
            "allow_powerups": false,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "Oxygen",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Gold",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Carbon",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "Hydrogen",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 6,
            "question": "In what year did the Titanic sink?",
            "time_limit": 45000,
            "allow_powerups": true,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "1912",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "1901",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "1925",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "1940",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 7,
            "question": "Which is the largest planet in our solar system?",
            "time_limit": 35000,
            "allow_powerups": false,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "Jupiter",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Saturn",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Neptune",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "Uranus",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 8,
            "question": "Who painted the Mona Lisa?",
            "time_limit": 30000,
            "allow_powerups": true,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "Leonardo da Vinci",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Vincent van Gogh",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Pablo Picasso",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "Michelangelo",
                    "is_correct": false
                }
            ]
        },
        {
            "index": 9,
            "question": "What is the currency of Australia?",
            "time_limit": 40000,
            "allow_powerups": false,
            "image": null,
            "answers": [
                {
                    "index": 0,
                    "answer": "Australian Dollar",
                    "is_correct": true
                },
                {
                    "index": 1,
                    "answer": "Euro",
                    "is_correct": false
                },
                {
                    "index": 2,
                    "answer": "Pound Sterling",
                    "is_correct": false
                },
                {
                    "index": 3,
                    "answer": "US Dollar",
                    "is_correct": false
                }
            ]
        }
    ]
} 
*/

import { CREATOR_URL } from "@/config"
import { IQuizDetail } from "@/interface/IQuizDetail"
import axios from "axios";
import {TIME} from "@/pages/create/components/time-input";

const getAuthorName = async (auth_id: string) => {
    try {
        const res = await axios.get(CREATOR_URL + "creator/" + auth_id);
        if (res.data.error) {
            return "Anonymous";
        }
        return res.data.name;
    }
    catch (err) {
        return "Anonymous";
    }
}

export const parseQuiz = async (quiz: any) => {
  const quizDetail: IQuizDetail = {
    id: quiz.quiz_id,
    image_url: quiz.image,
    title: quiz.title,
    description: quiz.description,
    num_played: quiz.num_play_times,
    updated_at: quiz.created_at,
    published: quiz.is_public,
    author: await getAuthorName(quiz.auth_id),
    authorId: quiz.auth_id,
    is_reported: false,
    has_draft: quiz.has_draft,
    favorite: quiz.favorite,
    questions: quiz.questions.map((question: any) => {
    const questionTime = question.time_limit / 1000;
    let time = TIME.find((val, id) => val === questionTime);
    if (time === undefined) {
        time = 0;
    }
      return {
        question: question.question,
        options: question.answers.map((answer: any) => {
          return {
            id: answer.index,
            text: answer.answer,
            correct: answer.is_correct,
          }
        }),
        time: time,
        powerUps: question.allow_powerups,
      }
    }),
  }
  
  return quizDetail;
}
    